<div class="max-w-6xl w-full bg-white rounded-2xl shadow-xl grid grid-cols-1 md:grid-cols-[1.5fr_1fr] overflow-hidden animate-fadeInZoom">

  <!-- Lado Izquierdo: Formulario -->
  <div class="p-8 space-y-5">
    <h2 class="text-[1.625rem] font-bold text-green-700 flex items-center gap-2">
      ‚ûï Crear nuevo sensor
    </h2>

    <form [formGroup]="form" (ngSubmit)="guardar()" class="grid grid-cols-1 sm:grid-cols-2 gap-5">
      <div>
        <label for="nombre" class="label">Nombre del sensor</label>
        <input id="nombre" type="text" formControlName="nombre" class="input input-bordered w-full" />
      </div>

      <div>
        <label for="fechaInstalacion" class="label">Fecha de instalaci√≥n</label>
        <input id="fechaInstalacion" type="date" formControlName="fechaInstalacion" class="input input-bordered w-full" />
      </div>

      <div>
        <label>Invernadero</label>
        <select id="invernadero_id" formControlName="invernadero_id" class="select select-bordered w-full">
          <option [ngValue]="null" diabled>Seleccione uno</option>
          <option *ngFor="let i of invernaderos" [value]="i.id">{{ i }}</option>
        </select>
      </div>

      <div>
        <label for="zona" class="label">Zona</label>
        <select id="zona" formControlName="zona" class="select select-bordered w-full">
          <option [ngValue]="null" disabled>Selecciona una zona</option>
          <option *ngFor="let z of zonas" [value]="z">{{ z }}</option>
        </select>
      </div>

      <div class="sm:col-span-2">
        <label for="descripcion" class="label">Descripci√≥n</label>
        <textarea id="descripcion" formControlName="descripcion" class="textarea textarea-bordered w-full" rows="3"></textarea>
      </div>

      <div>
        <label for="posX" class="label">Posici√≥n X</label>
        <input id="posX" type="number" formControlName="pos_x" class="input input-bordered w-full" />
      </div>

      <div>
        <label for="posY" class="label">Posici√≥n Y</label>
        <input id="posY" type="number" formControlName="pos_y" class="input input-bordered w-full" />
      </div>

      <div class="flex items-center gap-3">
        <label for="estado" class="label">Estado</label>
        <input id="estado" type="checkbox" formControlName="estado" class="toggle toggle-success" />
      </div>

      <div class="sm:col-span-2">
        <div class="sm:col-span-2">
          <label>Tipo de sensor</label>
          <select id="tipo_sensor_id" formControlName="tipo_sensor_id" class="select select-bordered w-full">
            <option [ngValue]="null" disabled>Selecciona un tipo de sensor</option>
            <option *ngFor="let tipo of tiposSensor" [value]="tipo.id">{{ tipo.nombre }}</option>
          </select>
        </div>
      </div>

      <!-- Botones -->
      <div class="sm:col-span-2 flex justify-between items-center pt-4">
        <button type="button" class="btn btn-outline" (click)="cerrar()">Cancelar</button>
        <button type="submit" class="btn btn-primary" [disabled]="form.invalid">
          üíæ Guardar sensor
        </button>
      </div>

      <p class="text-xs italic text-gray-500 sm:col-span-2">
        Despu√©s de guardar, se generar√° un token √∫nico para conectar el sensor.
      </p>
    </form>
  </div>

  <!-- Lado Derecho: Instrucciones + Mapa -->
  <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl max-w-xl w-full animate-fadeIn flex flex-col space-y-6">

    <!-- Mapa del sensor -->
    <div class="w-full h-64 bg-gray-100 rounded-lg shadow-inner flex items-center justify-center text-gray-400">
      [üó∫Ô∏è MAPA DE la ZONA]
    </div>

    <h3 class="text-lg font-bold flex items-center gap-2 text-gray-800">
      üîå Instrucciones de conexi√≥n
    </h3>
    <p class="text-sm text-gray-600 leading-relaxed">
      Para que el sensor env√≠e datos correctamente, deber√° conectarse a la API usando el token generado autom√°ticamente.
    </p>

    <!-- Ejemplo de JSON -->
    <div class="bg-gray-100 p-4 rounded-lg font-mono text-xs text-gray-800 leading-snug overflow-x-auto whitespace-pre">
      <p class="text-sm font-bold mb-2">Ejemplo de formato JSON:</p>
      <code>
        {{ '{' }}<br />
        &nbsp;&nbsp;"token": "9f0e4adf7b23a",<br />
        &nbsp;&nbsp;"parametros": {{ '{' }} <br />
        &nbsp;&nbsp;"temperatura": 25.4,<br />
        &nbsp;&nbsp;"humedad": 80.2<br />
        &nbsp;&nbsp;{{ '}' }},<br />
        {{ '}' }}
      </code>
    </div>

    <!-- Endpoint -->
    <p class="text-sm"><strong>Endpoint:</strong>
      <code class="text-blue-700 font-mono"> POST /api/sensores/datos</code>
    </p>

    <!-- Advertencia token -->
    <div class="bg-yellow-100 text-yellow-900 text-sm border-l-4 border-yellow-400 p-4 rounded-lg flex gap-3 items-start">
      <span class="text-xl leading-none">‚ö†Ô∏è</span>
      <p>Este token es <strong>sensible</strong> y debe mantenerse privado.</p>
    </div>
  </div>
</div>
<!-- Modal de Token -->
<ng-container *ngIf="tokenModalOpen">
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl max-w-md w-full space-y-6 animate-fadeInZoom">
      <!-- Encabezado mejorado -->
      <header class="flex items-center gap-3">
        <span class="text-2xl">üîë</span>
        <h2 class="text-2xl font-bold">¬°Token de Conexi√≥n Generado!</h2>
      </header>
      <!-- Descripci√≥n adicional -->
      <p class="text-sm text-gray-600">
        Este token permite que tu sensor env√≠e datos de forma segura a la API. Aseg√∫rate de copiarlo y almacenarlo en un lugar seguro, ya que no podr√°s verlo de nuevo.
      </p>
      <!-- Campo de token con botones de mostrar/ocultar y copiar -->
      <div class="relative">
        <input
          [type]="tokenHidden ? 'password' : 'text'"
          [value]="tokenValue"
          readonly
          class="input input-bordered input-lg w-full pr-20"
        />
        <button
          type="button"
          class="absolute top-1/2 right-20 transform -translate-y-1/2 btn btn-sm"
          (click)="toggleTokenVisibility()"
        >
          {{ tokenHidden ? 'Mostrar' : 'Ocultar' }}
        </button>
        <button
          type="button"
          class="absolute top-1/2 right-2 transform -translate-y-1/2 btn btn-primary btn-sm"
          (click)="copyToken()"
          tooltip="Copiar al portapapeles"
        >
          üìã Copiar
        </button>
      </div>
      <!-- Bot√≥n de cierre -->
      <div class="flex justify-end">
        <button
          type="button"
          class="btn btn-outline"
          (click)="closeTokenModal()"
        >
          Cerrar
        </button>
      </div>
    </div>
  </div>
</ng-container>
